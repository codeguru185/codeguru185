-- Step 1: Identify all databases
WITH databases AS (
    SELECT
        catalog_name AS database_name
    FROM
        information_schema.catalogs
    WHERE
        catalog_name NOT IN ('INFORMATION_SCHEMA', 'SNOWFLAKE')
),

-- Step 2: Retrieve schema details for each database
schemas AS (
    SELECT
        c.catalog_name AS database_name,
        s.schema_name,
        s.is_transient,
        s.created,
        s.last_altered
    FROM
        databases c
    JOIN
        information_schema.schemata s ON c.catalog_name = s.catalog_name
    WHERE
        s.schema_name != 'PUBLIC'  -- Exclude PUBLIC schema
)

-- Step 3: Combine results
SELECT
    database_name,
    schema_name,
    is_transient,
    created,
    last_altered
FROM
    schemas
ORDER BY
    database_name,
    schema_name;
