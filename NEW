#!/bin/bash

# Hive connection details
HIVE_HOST="your_hive_host"
HIVE_PORT="your_hive_port"
HIVE_USER="your_hive_user"
HIVE_PASSWORD="your_hive_password"

# Hive query to get databases
DATABASES=$(beeline -u "jdbc:hive2://$HIVE_HOST:$HIVE_PORT" -n "$HIVE_USER" -p "$HIVE_PASSWORD" -e "SHOW DATABASES;")

# Iterate through each database
for DB in $DATABASES; do
    echo "Database: $DB"
    
    # Hive query to get tables in the current database
    TABLES=$(beeline -u "jdbc:hive2://$HIVE_HOST:$HIVE_PORT/$DB" -n "$HIVE_USER" -p "$HIVE_PASSWORD" -e "SHOW TABLES;")

    # Iterate through each table in the current database
    for TABLE in $TABLES; do
        # Hive query to get table size and creator
        TABLE_INFO=$(beeline -u "jdbc:hive2://$HIVE_HOST:$HIVE_PORT/$DB" -n "$HIVE_USER" -p "$HIVE_PASSWORD" -e "DESCRIBE EXTENDED $TABLE;")

        # Extracting size and creator from the table information
        TABLE_SIZE=$(echo "$TABLE_INFO" | grep "totalSize" | awk '{print $2}')
        TABLE_CREATOR=$(echo "$TABLE_INFO" | grep "Owner:" | awk '{print $2}')

        # Print the details
        echo "  Table: $TABLE | Size: $TABLE_SIZE | Created by: $TABLE_CREATOR"
    done
done
